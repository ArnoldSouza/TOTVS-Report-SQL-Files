SELECT
	--IDENTIFICA LOCAL
	REPLACE(RTRIM(CTT010.CTT_XREGIO),'_',' ') AS 'REGIONAL',
	IIF(
		REPLACE(REPLACE(RTRIM(CTT_XPOLO),'_',' '),'POLO ', '')=REPLACE(RTRIM(CTT010.CTT_XREGIO),'_',' '),
		REPLACE(REPLACE(RTRIM(CTT_XPOLO),'_',' '),'POLO ', ''),
		REPLACE(REPLACE(REPLACE(RTRIM(CTT_XPOLO),'_',' '),'POLO ', ''), REPLACE(RTRIM(CTT010.CTT_XREGIO),'_',' ')+' ', '')
	) AS 'POLO',
	SC7010.C7_FILIAL+SC7010.C7_LOCAL+' - '+Z01010.Z01_DESC AS 'DESCRIÇÃO ARMAZÉM',
	
	-- IDENTIFICA PROCESSO
	SC7010.C7_NUM AS 'NUM PC',
	SC7010.C7_ITEM AS 'ITEM',
	SC7010.C7_NUMSC AS 'NUM SC',
	SC7010.C7_ITEMSC AS 'ITEM SC',	
	
	--DETALHES DE VALOR E PRODUTO
	SC7010.C7_PRODUTO AS 'CODIGO',
	RTRIM(SC7010.C7_DESCRI) AS 'DESCRIÇÃO',
	SC7010.C7_UM AS 'UND',
	SC7010.C7_QUANT AS 'QTDE',
	SC7010.C7_PRECO AS 'VAL UND',
	SC7010.C7_TOTAL AS 'TOTAL',
	SC7010.C7_OBS AS 'OBSERVAÇÃO',

	--ACOMPANHAMENTO DE COMPRA/ENTREGA
	SC7010.C7_QUJE+SC7010.C7_QTDACLA AS 'QUANTIDADE RECEBIDA',
	(SC7010.C7_QUJE+SC7010.C7_QTDACLA)*SC7010.C7_PRECO AS 'TOTAL RECEBIDO',
	SC7010.C7_QUJE AS 'QTDE ENTREGUE',
	SC7010.C7_QTDACLA AS 'QTDE A CLASSI',
	SC7010.C7_QUANT-(SC7010.C7_QUJE+SC7010.C7_QTDACLA) AS 'QTDE FALTA',
	(SC7010.C7_QUANT-(SC7010.C7_QUJE+SC7010.C7_QTDACLA))*SC7010.C7_PRECO AS 'VALOR FALTA',

	-- SITUAÇÃO DO PROCESSO
	CASE WHEN SC7010.C7_CONAPRO = 'L' THEN 'APROVADO' ELSE 'BLOQUEADO' END AS 'SITUAÇÃO PC',
	CASE 
		WHEN (SC7010.C7_QUJE+SC7010.C7_QTDACLA)=SC7010.C7_QUANT THEN 'RECEBIDO TOTALMENTE'
		WHEN (SC7010.C7_QUJE+SC7010.C7_QTDACLA)=0 THEN 'FALTA RECEBER'
		WHEN (SC7010.C7_QUJE+SC7010.C7_QTDACLA)<SC7010.C7_QUANT AND (SC7010.C7_QUJE+SC7010.C7_QTDACLA)>0 THEN 'RECEBIDO PARCIAL'
		ELSE 'ERRO'
	END AS 'SITUAÇÃO DO PC',
	SC7010.C7_TPCOMPR AS 'TIPO DE COMPRA',
	SC7010.C7_ENCER AS 'PED. ENCER.',
	SC7010.C7_STEND AS 'STATUS DO PC',
	
	--FAZ PESQUISA NO HISTÓRICO DE COMPRAS SOBRE O PC EM QUESTÃO
	-- (
		-- SELECT TOP 1 RTRIM(ZE2010.ZE2_OBS)
		-- FROM ZE2010
		-- WHERE ZE2010.ZE2_PEDIDO = SC7010.C7_NUM AND ZE2010.ZE2_FILIAL = SC7010.C7_FILIAL AND ZE2010.D_E_L_E_T_ <> '*'
		-- ORDER BY ZE2010.R_E_C_N_O_ DESC
	-- ) AS 'OBS STATUS'

	--RESPONSÁVEL PELO PROCESSO
	SC7010.C7_USER AS 'COD COMPRADOR',
	RTRIM(SY1010.Y1_NOME) AS 'NOME COMPRADOR',
	SC7010.C7_GRUPCOM AS 'GRUP COMPR',
	
	--ESPECIFICA FORNECEDOR
	SC7010.C7_FORNECE AS 'FORNECEDOR',
	SC7010.C7_NOMFOR AS 'NOME FORNECEDOR',
	
	--CLASSIFICADORES
	SB1010.B1_GRUPO AS 'COD GRUPO',
	RTRIM(SBM010.BM_DESC) AS 'DESC GRUPO',
	SC7010.C7_CC AS 'CENTRO DE  CUSTO',
	CASE WHEN SC7010.C7_CC = '         ' THEN 'PROCESSO PARA ARMAZÉM' ELSE RTRIM(CTT010.CTT_DESC01) END AS 'DESCRIÇÃO CENTRO DE CUSTO', 
	SC7010.C7_CONTA AS 'CONTA CONTÁBIL',
	CASE WHEN SC7010.C7_CONTA = '                    ' THEN 'ATIVO FIXO' ELSE RTRIM(CT1010.CT1_DESC01) END AS 'DESC CONT CONTÁBIL',
	SC7010.C7_ITEMCTA AS 'CARRO',
	RTRIM(SC7010.C7_ITEMCTA+' - '+CTD010.CTD_DESC01) AS 'DESC CARRO',
	SC7010.C7_CLVL AS 'OBRA',
	RTRIM(SC7010.C7_CLVL)+' - '+RTRIM(CTH010.CTH_DESC01) AS 'DESC OBRA/PROJETO',
	SB1010.B1_TIPO+' - '+
	(
		SELECT SX5010.X5_DESCRI
		FROM PROTHEUS.dbo.SX5010 SX5010
		WHERE X5_TABELA='02' AND SX5010.X5_CHAVE=SB1010.B1_TIPO
	) AS 'DESCRIÇÃO TIPO DO PRODUTO',
	BM_TIPGRU+' - '+
	(
		SELECT SX5010.X5_DESCRI
		FROM PROTHEUS.dbo.SX5010 SX5010
		WHERE X5_TABELA='V0' AND SX5010.X5_CHAVE=BM_TIPGRU
	) AS 'DESCRIÇÃO TIPO DE GRUPO',
	
	--CLASSIFICAÇÃO QUANTO A QUAL LOCAL COMPROU
	CASE
		WHEN (SC7010.C7_USER IN ('000044','000053','001193','001372','000238'))
			THEN 'COMPRAS'
		WHEN (SC7010.C7_USER IN ('000069','001417','000148','000852','000896','000655','000224','000190','001036','000444','001481','000797'))
			THEN 'ADM'
		WHEN (SC7010.C7_USER IN ('000216','001353','001362','000892','000815','001212','000554','000485','000663','001136','001042','000262','000937','000364','000567','001281','001391','001337','000246','001433','000894','001540','001328','000316','000993','000370','000376','000807','000306','000301','001506','000208','000571','000917','001562','000720','001329','001468','000435','001368','000283','000401'))
			THEN 'LOCAL'
		WHEN (SC7010.C7_USER IN ('000646','001494','001039','000226','001520','001165','001480','001211','000932','000050','000215','001145','000902','001280','000593','001161'))
			THEN 'MATRIZ - OUTROS'
		ELSE 'ERRO: CLASSIFICAR'
	END AS 'DPTO COMPRA',
	
	--CLASSIFICAÇÃO QUANTO A QUAL LOCAL É RESPONSÁVEL PELO PROCESSO
	CASE 
		WHEN SB1010.B1_GRUPO IN ('0780','4006','0716','0051','0050','1026','0229','0096','0211','0012','0013','0014','0052','0053','0054','0090','0091','0092','0093','0094','0095','0098','0099','1021','4004','4005','4010') 
			THEN 'FROTA' 
		WHEN SB1010.B1_GRUPO IN ('1027','0227','0226','0215','0254','0212','0050','0051','0130','0131','0132','0133','0250','0253','0255','0256','0257','4003','4008') 
			THEN 'SUPRIMENTOS' 
		WHEN SB1010.B1_GRUPO IN ('0982','0983','0984','0980','0985','0986','0981','0702','0781','1065','0758','0215','0253','0252','0251','0755','0223','0170','0171','0172','0173','0175','0176','0177','0216','0701','0709','0711','0712','0717','0718','0719','0740','0747','0748','0754','0756','0860','0861','0863','0864','0980','0982','0983','1020','4007','4009') 
			THEN 'ADMINISTRATIVO' 
		ELSE 'GERAL' 
	END AS 'DPTO RESPONSÁVEL',
	
	--CLASSIFICAÇÃO QUANTO AO TIPO DE GASTO
	CASE
		WHEN SC7010.C7_PRODUTO IN ('00130004', '00130002', '00130001') THEN 'FROTA - COMBUSTÍVEL'
		WHEN (SB1010.B1_GRUPO IN ('4004', '4005','4006', '4010') OR SC7010.C7_PRODUTO IN ('00526075','02550337','40030031','02550338','00510017','02550339')) THEN 'FROTA - VEICULOS'
		WHEN (SB1010.B1_GRUPO = '0014' OR BM_TIPGRU='MV') THEN 'FROTA - MATERIAIS VEICULARES'
		WHEN BM_TIPGRU='SV' THEN 'FROTA - SERVIÇOS VEICULARES'
		WHEN SB1010.B1_GRUPO = '1026' THEN 'FROTA - TRANSPORTE DE VEICULOS'
		WHEN SB1010.B1_GRUPO IN ('0982', '0984') THEN 'VIAGENS - REEMBOLSAVEIS'
		WHEN SB1010.B1_GRUPO IN ('0983', '0980', '0985', '0986', '0981') THEN 'VIAGENS - NÃO REEMBOLSAVEIS'
		WHEN SB1010.B1_GRUPO IN ('0740', '0861', '0863', '0864', '0719','1020', '0860') THEN 'UTILIDADES'
		WHEN SC7010.C7_PRODUTO = '10210001' THEN 'FRETES - REEMBOLSAVEIS'
		WHEN SB1010.B1_GRUPO IN ('1028', '1027', '1026') THEN 'FRETES - NÃO REEMBOLSAVEIS'
		WHEN (BM_TIPGRU IN ('SS','SV', 'FR', 'SG') OR (BM_TIPGRU = 'DG' AND LEFT(SB1010.B1_DESC,7)='SERVICO')) THEN 'SERVIÇOS TOMADOS'
		WHEN 
			(
				(SC7010.C7_CONTA = '                    ') OR
				(LEFT(SC7010.C7_CONTA,3)='132')
			) THEN 'INVESTIMENTO - ATIVO FIXO'
		WHEN (SC7010.C7_CC = '         ' AND ((SC7010.C7_FILIAL='02' AND SC7010.C7_LOCAL IN ('21', '22')) OR (SC7010.C7_FILIAL='12' AND SC7010.C7_LOCAL IN ('91', '92')))) THEN 'ESTOQUE - INSUMOS PARA FATURAMENTO'
		WHEN (SC7010.C7_CC = '         ' AND SC7010.C7_CLVL = '001') THEN 'ESTOQUE - MOBILIZAÇÕES'
		WHEN (SC7010.C7_CC = '         ' AND SC7010.C7_CLVL <> '001') THEN 'ESTOQUE - CONSUMO OPERACIONAL'
		WHEN SC7010.C7_CLVL = '001' THEN 'INVESTIMENTO - MOBILIZAÇÕES'
		WHEN SC7010.C7_CC <> '         ' AND CTT010.CTT_TPCC = 'O' THEN 'APLICAÇÃO DIRETA - CUSTEIO OPERACIONAL'
		WHEN SC7010.C7_CC <> '         ' AND CTT010.CTT_TPCC = 'C' THEN 'APLICAÇÃO DIRETA - DESPESAS CORPORATIVAS'
		ELSE 'ERRO: CLASSIFICAR'
	END AS 'TIPO DE GASTO',

	--DATAS DO PROCESSO
	Case RTrim(Coalesce(SC7010.C7_EMISSAO,'')) WHEN ''  THEN Null ELSE convert(DATE, SC7010.C7_EMISSAO, 112)END AS 'DT EMISSÃO',
	Case RTrim(Coalesce(SC7010.C7_ALTDATA,'')) WHEN ''  THEN Null ELSE convert(DATE, SC7010.C7_ALTDATA, 112)END AS 'DT ALTERADO',
	Case RTrim(Coalesce(SC7010.C7_DTLIB1,'')) WHEN ''  THEN Null ELSE convert(DATE, SC7010.C7_DTLIB1, 112)END AS 'DT LIBERADO1',
	Case RTrim(Coalesce(SC7010.C7_DTLIB2,'')) WHEN ''  THEN Null ELSE convert(DATE, SC7010.C7_DTLIB2, 112)END AS 'DT LIBERADO2',
	Case RTrim(Coalesce(SC7010.C7_DTLIB3,'')) WHEN ''  THEN Null ELSE convert(DATE, SC7010.C7_DTLIB3, 112)END AS 'DT LIBERADO3',
	Case RTrim(Coalesce(SC7010.C7_DTLIB4,'')) WHEN ''  THEN Null ELSE convert(DATE, SC7010.C7_DTLIB4, 112)END AS 'DT LIBERADO4',
	Case RTrim(Coalesce(SC7010.C7_DTLIB5,'')) WHEN ''  THEN Null ELSE convert(DATE, SC7010.C7_DTLIB5, 112)END AS 'DT LIBERADO5',
	Case RTrim(Coalesce(SC7010.C7_DTLIB6,'')) WHEN ''  THEN Null ELSE convert(DATE, SC7010.C7_DTLIB6, 112)END AS 'DT LIBERADO6',
	Case RTrim(Coalesce(SC7010.C7_DTLIB7,'')) WHEN ''  THEN Null ELSE convert(DATE, SC7010.C7_DTLIB7, 112)END AS 'DT LIBERADO7',
	
	--DATAS ALTERNATIVAS
	--ERRO--Case RTrim(Coalesce(SC7010.C7_DATPRF,'')) WHEN ''  THEN Null ELSE convert(DATE, SC7010.C7_DATPRF, 112)END AS 'DT PREV ENTREGA', --*NÃO UTILIZADO* -> NÃO SE SABE COMO O SISTEMA PREENCHE ESSE DADO
	Case RTrim(Coalesce(SC7010.C7_DTNEGOC,'')) WHEN ''  THEN Null ELSE convert(DATE, SC7010.C7_DTNEGOC, 112)END AS 'DT PREV FATURA', --É USADO
	Case RTrim(Coalesce(SC7010.C7_DTLANC,'')) WHEN ''  THEN Null ELSE convert(DATE, SC7010.C7_DTLANC, 112)END AS 'DT CONTABILIZAÇÃO', --*NÃO UTILIZADO*
	Case RTrim(Coalesce(SC7010.C7_DTENTRA,'')) WHEN ''  THEN Null ELSE convert(DATE, SC7010.C7_DTENTRA, 112)END AS 'DT ENTRA NF', --É AUTOMÁTICO
	--ERRO--Case RTrim(Coalesce(SC7010.C7_DINICOM,'')) WHEN ''  THEN Null ELSE convert(DATE, SC7010.C7_DINICOM, 112)END AS 'DT P/ INICIO COMPRA' --*NÃO UTILIZADO*
	
	--DATA DE APROVAÇÃO
	CONVERT(DATE,
		(
			SELECT MAX(LastUpdateDate)
			FROM (VALUES (SC7010.C7_DTLIB1),(SC7010.C7_DTLIB2),(SC7010.C7_DTLIB3),(SC7010.C7_DTLIB4),(SC7010.C7_DTLIB5),(SC7010.C7_DTLIB6),(SC7010.C7_DTLIB7), (SC7010.C7_EMISSAO), (SC7010.C7_ALTDATA)) AS UpdateDate(LastUpdateDate)
		)
	, 112) AS 'DT APROVAÇÃO',
	
	--TEMPO ATÉ APROVAR PROCESSO
	DATEDIFF(DAY,
	   CONVERT(
		   DATE,
			   (
					SELECT MAX(LastUpdateDate)
					FROM (VALUES (SC7010.C7_DTLIB1),(SC7010.C7_DTLIB2),(SC7010.C7_DTLIB3),(SC7010.C7_DTLIB4),(SC7010.C7_DTLIB5),(SC7010.C7_DTLIB6),(SC7010.C7_DTLIB7), (SC7010.C7_EMISSAO), (SC7010.C7_ALTDATA)) AS UpdateDate(LastUpdateDate)
				)
		), CONVERT(DATE, (CASE WHEN SC7010.C7_ALTDATA='' THEN SC7010.C7_EMISSAO ELSE SC7010.C7_ALTDATA END), 112)
	) AS 'TEMPO APROVA',

	-- APROVADORES DO PROCESSO
	SC7010.C7_APROV1 AS 'APROVADOR 1',
	SC7010.C7_APROV2 AS 'APROVADOR 2',
	SC7010.C7_APROV3 AS 'APROVADOR 3',
	SC7010.C7_APROV4 AS 'APROVADOR 4',
	SC7010.C7_APROV5 AS 'APROVADOR 5',
	SC7010.C7_APROV6 AS 'APROVADOR 6',
	SC7010.C7_APROV7 AS 'APROVADOR 7',

	--***************************************--
	--*** DADOS DE SOLICITAÇÃO DE COMPRAS ***--
	--***************************************--
	
	--SC: CONEXÃO COM TABELA DE SOLICITAÇÃO DE COMPRA
	SC1010.C1_UM AS 'SC: UND', 
	SC1010.C1_QUANT AS 'SC: QTDE', 
	SC1010.C1_VLESTIM AS 'SC: VAL. UND.',
	SC1010.C1_VTOTAL AS 'SC: VAL TOTAL',
	SC1010.C1_TOTSC AS 'SC: VAL TOTAL SC',
	Case RTrim(Coalesce(SC1010.C1_DTLIB1,'')) WHEN ''  THEN Null ELSE convert(DATE, SC1010.C1_DTLIB1, 112)END AS 'DT LIBERADO1',
	Case RTrim(Coalesce(SC1010.C1_DTLIB2,'')) WHEN ''  THEN Null ELSE convert(DATE, SC1010.C1_DTLIB2, 112)END AS 'DT LIBERADO2',
	Case RTrim(Coalesce(SC1010.C1_DTLIB3,'')) WHEN ''  THEN Null ELSE convert(DATE, SC1010.C1_DTLIB3, 112)END AS 'DT LIBERADO3',
	Case RTrim(Coalesce(SC1010.C1_DTLIB4,'')) WHEN ''  THEN Null ELSE convert(DATE, SC1010.C1_DTLIB4, 112)END AS 'DT LIBERADO4',
	Case RTrim(Coalesce(SC1010.C1_DTLIB5,'')) WHEN ''  THEN Null ELSE convert(DATE, SC1010.C1_DTLIB5, 112)END AS 'DT LIBERADO5',
	Case RTrim(Coalesce(SC1010.C1_DTLIB6,'')) WHEN ''  THEN Null ELSE convert(DATE, SC1010.C1_DTLIB6, 112)END AS 'DT LIBERADO6',
	Case RTrim(Coalesce(SC1010.C1_DTLIB7,'')) WHEN ''  THEN Null ELSE convert(DATE, SC1010.C1_DTLIB7, 112)END AS 'DT LIBERADO7',
	Case RTrim(Coalesce(SC1010.C1_EMISSAO,'')) WHEN ''  THEN Null ELSE convert(DATE, SC1010.C1_EMISSAO, 112)END AS 'EMISSÃO',
	Case RTrim(Coalesce(SC1010.C1_ALTDATA,'')) WHEN ''  THEN Null ELSE convert(DATE, SC1010.C1_ALTDATA, 112)END AS 'DT ALT',
	--SC: DATA DE APROVAÇÃO
	CONVERT(DATE,
		(
			SELECT MAX(LastUpdateDate)
			FROM (VALUES (SC1010.C1_DTLIB1),(SC1010.C1_DTLIB2),(SC1010.C1_DTLIB3),(SC1010.C1_DTLIB4),(SC1010.C1_DTLIB5),(SC1010.C1_DTLIB6),(SC1010.C1_DTLIB7), (SC1010.C1_EMISSAO), (SC1010.C1_ALTDATA)) AS UpdateDate(LastUpdateDate)
		)
	, 112) AS 'DT APROVAÇÃO',
	--SC: TEMPO ATÉ APROVAR PROCESSO
	DATEDIFF(DAY,
	   CONVERT(
		   DATE,
			   (
					SELECT MAX(LastUpdateDate)
					FROM (VALUES (SC1010.C1_DTLIB1),(SC1010.C1_DTLIB2),(SC1010.C1_DTLIB3),(SC1010.C1_DTLIB4),(SC1010.C1_DTLIB5),(SC1010.C1_DTLIB6),(SC1010.C1_DTLIB7), (SC1010.C1_EMISSAO), (SC1010.C1_ALTDATA)) AS UpdateDate(LastUpdateDate)
				)
		),CONVERT(DATE, (CASE WHEN SC1010.C1_ALTDATA='' THEN SC1010.C1_EMISSAO ELSE SC1010.C1_ALTDATA END), 112)
	) AS 'TEMPO APROVA',
	
	--***************************************--
	--*** DADOS DE SOLICITAÇÃO DE COMPRAS ***--
	--***************************************--
	
	--INFOS ADICIONAIS SOBRE PC
	SC7010.C7_HORINCL AS 'HORA INCLU.',
	
	--CONJUNTO DE DADOS DE ALTERAÇÃO DE PC E FILIAL DE DESTINO
	SC7010.C7_ALTUSR AS ' USER ALT.',
	SC7010.C7_ALTMOT AS 'ALT. OBS',
	SC7010.C7_XFILENT AS 'FIL. ENTR.',
	SC7010.C7_FILENT AS 'FIL. ENTR. 2', -- **ESTRANHAMENTE TEM UM CAMPO REPETIDO DE FILIAL DE ENTREGA
	SC7010.C7_XLOCENT AS 'LOC. ENTR.',

	--DADOS FRETE
	SC7010.C7_TPFRETE AS 'FRETE TIPO',
	SC7010.C7_FRETE AS 'FRETE VAL',
	SC7010.C7_VALFRE AS 'VAL FRETE',
	
	--DADOS DESPESAS
	SC7010.C7_VALEMB AS 'Valor da Embalagem',
	SC7010.C7_SEGURO AS 'VALOR SEGURO',
	SC7010.C7_DESPESA AS 'VAL DESPESAS',
	
	-- IMPOSTOS
	SC7010.C7_IPI AS 'ALIQ. IPI',
	SC7010.C7_VALIPI AS 'Valor do IPI do Item',
	SC7010.C7_PICM AS 'ALIQ. ICMS',
	SC7010.C7_VALICM AS 'Valor do ICMS do item',
	SC7010.C7_BASEICM AS 'BASE ICMS',
	SC7010.C7_BASEIPI AS 'BASE IPI',
	SC7010.C7_ICMCOMP AS 'ICMS Compl.',
	SC7010.C7_ICMSRET AS 'ICMS Retido',
	SC7010.C7_IPIBRUT AS 'Considera Desconto p/IPI',

	--CONDIÇÃO DE PAGAMENTO
	SC7010.C7_COND AS 'COND PAG',
	SE4010.E4_COND AS 'COD PAG DETALHE',
	SE4010.E4_DESCRI AS 'DESRIÇÃO PAGAMENTO',
	
	--DESCONTOS: OS DESCONTOS DE 1 A 3 SÃO APLICADOS NO VALOR TOTAL DE COMRRA POR REGISTRO
	SC7010.C7_DESC1 AS 'DESCONTO 1', -- DESCONTO EM PORCENTAGEM (%) 
	SC7010.C7_DESC2 AS 'DESCONTO 2', -- DESCONTO EM PORCENTAGEM (%) 
	SC7010.C7_DESC3 AS 'DESCONTO 3', -- DESCONTO EM PORCENTAGEM (%) 
	SC7010.C7_VLDESC AS 'VAL DESC',
	
	--INFORMAÇÕES VARIADAS
	SC7010.C7_MSG AS 'MSG PARA PEDIDO',
	SC7010.C7_TES AS 'Tipo de entrada da nota',
	SC7010.C7_ESTOQUE AS 'ATU ESTOQUE',
	
	--COTAÇÕES, CONTRATOS E ORÇAMENTOS
	SC7010.C7_CODORCA AS 'COD ORÇAMENTO',
	SC7010.C7_CONTRA AS 'NUM CONTRATO',
	SC7010.C7_NUMCOT AS 'NUM COTAÇÃO',
	SC7010.C7_CONTATO AS 'CONTATO'

FROM PROTHEUS.dbo.SC7010 SC7010
	LEFT JOIN PROTHEUS.dbo.Z01010 Z01010 ON (Z01010.Z01_FILIAL = SC7010.C7_FILIAL) AND (Z01010.Z01_COD = SC7010.C7_LOCAL) AND Z01010.D_E_L_E_T_<>'*'
	LEFT JOIN PROTHEUS.dbo.CTT010 CTT010 ON SC7010.C7_CC=CTT010.CTT_CUSTO AND CTT010.D_E_L_E_T_<>'*'
	LEFT JOIN PROTHEUS.dbo.CT1010 CT1010 ON SC7010.C7_CONTA=CT1010.CT1_CONTA AND CT1010.D_E_L_E_T_<>'*'
	LEFT JOIN PROTHEUS.dbo.CTD010 CTD010 ON SC7010.C7_ITEMCTA=CTD010.CTD_ITEM AND CTD010.D_E_L_E_T_<>'*'
	LEFT JOIN PROTHEUS.dbo.CTH010 CTH010 ON SC7010.C7_CLVL=CTH010.CTH_CLVL AND CTH010.D_E_L_E_T_<>'*'
	LEFT JOIN PROTHEUS.dbo.SB1010 SB1010 ON SC7010.C7_PRODUTO=SB1010.B1_COD AND SB1010.D_E_L_E_T_<>'*'
	LEFT JOIN PROTHEUS.dbo.SBM010 SBM010 ON SB1010.B1_GRUPO=SBM010.BM_GRUPO AND SBM010.D_E_L_E_T_<>'*'
	LEFT JOIN PROTHEUS.dbo.SY1010 SY1010 ON SC7010.C7_USER=SY1010.Y1_USER AND SY1010.D_E_L_E_T_<>'*'
	LEFT JOIN PROTHEUS.dbo.SE4010 SE4010 ON SC7010.C7_COND=SE4010.E4_CODIGO AND SE4010.D_E_L_E_T_<>'*'
	--CONEXÃO COM TABELA DE COMPRAS (SC1)
	LEFT JOIN PROTHEUS.dbo.SC1010 SC1010 ON (SC1010.C1_NUM = SC7010.C7_NUMSC) AND (SC1010.C1_ITEM = SC7010.C7_ITEMSC) AND SC1010.D_E_L_E_T_<>'*'
WHERE 
	(SC7010.C7_EMISSAO>='20180101' AND SC7010.C7_EMISSAO<=GETDATE()) AND -- RESTRINGE INTERVALO DE TEMPO
	(SC7010.D_E_L_E_T_<>'*') AND --DESCONSIDERA DELETADOS
	--GRUPOS QUE NÃO PERTENCEM À ANÁLISE (GERALMENTE PARTENCENTES AO RH)
	(SB1010.B1_GRUPO NOT IN ('0984', '0824', '0095', '0093', '0096', '1023', '0943', '3061','3058','1214','1221','1061','1220','3003','3001','1200','1219','0710','3002','0720','3004','3050','3006','0703','1024','0700','1218','1203','1211','1205','1202','1204','0752','3007','0820','0823','3005','0743','1206','0174','1022','3060','1213','1215','1208','3000','0825')) --AND

-- 	(SC7010.C7_CONAPRO = 'L') AND --PC APROVADOS
-- 	(SC7010.C7_QUJE+SC7010.C7_QTDACLA)<SC7010.C7_QUANT AND --SOMENTE MATERIAL ENTREGUE
--  (SC7010.C7_RESIDUO<>' ') AND --NÃO ELIMINADO POR RESÍDUO
-- 	(SC7010.C7_CC = '         ') AND --CENTRO DE CUSTO 
--  (SC7010.C7_FILIAL='12') AND --FIXA FILIAL 
--  (SC7010.C7_LOCAL = '90') AND  --FIXA ARMAZÉM
--  (SC7010.C7_CLVL<>'001') AND --DESCONSIDERA MOBILIZAÇÕES
-- 	(SC7010.C7_USER IN ('000044','000053')) --RESTRINGE COMPRADORES
ORDER BY 
	SC7010.C7_EMISSAO,
	SC7010.C7_NUM,
	SC7010.C7_ITEM