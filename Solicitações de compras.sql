SELECT 
	SC1010.C1_FILIAL AS 'FILIAL', 
	SC1010.C1_LOCAL AS 'ARMAZÉM',
	SC1010.C1_FILIAL+SC1010.C1_LOCAL+' - '+Z01010.Z01_DESC AS 'DESCRIÇÃO ARMAZÉM',
	SC1010.C1_NUM AS 'NUM SC', 
	SC1010.C1_ITEM AS 'ITEM', 
	SC1010.C1_PRODUTO AS 'CODIGO', 
	RTRIM(SC1010.C1_DESCRI) AS 'DESCRIÇÃO',
	SC1010.C1_UM AS 'UND', 
	SC1010.C1_QUANT AS 'QTDE', 
	SC1010.C1_VLESTIM AS 'VAL. UND.',
	SC1010.C1_VTOTAL AS 'VAL TOTAL', 
	SC1010.C1_TOTSC AS 'VAL TOTAL SC',
	SC1010.C1_QUJE AS 'QTDE EM PEDIDO',
	SC1010.C1_QUJE*SC1010.C1_VLESTIM AS 'VALOR ATENDIDO',
	(SC1010.C1_QUANT-SC1010.C1_QUJE) AS 'QTDE FALTA',
	(SC1010.C1_QUANT-SC1010.C1_QUJE)*SC1010.C1_VLESTIM AS 'VAL FALTA',
	CASE WHEN (SC1010.C1_QUANT-SC1010.C1_QUJE)=0 THEN 'NÃO' WHEN (SC1010.C1_QUANT-SC1010.C1_QUJE)>0 THEN 'SIM' ELSE 'ERRO' END AS 'FALTA COMPRAR',
	SB1010.B1_GRUPO AS 'COD GRUPO',
	RTRIM(SBM010.BM_DESC) AS 'DESC GRUPO',
	Case RTrim(Coalesce(SC1010.C1_DATPRF,'')) WHEN ''  THEN Null ELSE convert(datetime, SC1010.C1_DATPRF, 112)END AS 'DT NECESSIDADE',
	SC1010.C1_OBS AS 'OBSERVAÇÃO', 
	CASE WHEN SC1010.C1_CC = '          ' THEN 'PARA ARMAZÉM' ELSE 'APLICAÇÃO DIRETA' END AS 'TIPO DE COMPRA',
	SC1010.C1_CC AS 'CENTRO DE CUSTO', 
	CASE WHEN SC1010.C1_CC = '          ' THEN 'PROCESSO PARA ARMAZÉM' ELSE RTRIM(CTT010.CTT_DESC01) END AS 'DESCRIÇÃO CENTRO DE CUSTO', 
	SC1010.C1_CONTA AS 'CONTA CONTÁBIL',
	CASE WHEN SC1010.C1_CONTA = '                    ' THEN 'ATIVO FIXO' ELSE RTRIM(CT1010.CT1_DESC01) END AS 'DESC CONT CONTÁBIL',
	SC1010.C1_ITEMCTA AS 'CARRO',
	RTRIM(SC1010.C1_ITEMCTA+' - '+CTD010.CTD_DESC01) AS 'DESC CARRO',
	SC1010.C1_PEDIDO AS 'NUM PC', 
	SC1010.C1_ITEMPED AS 'ITEM PC',
	SC1010.C1_USER AS 'COD SOLICITANTE SC',  
	SC1010.C1_SOLICIT AS 'NOME SOLICITANTE SC',  
	SC1010.C1_CODCOMP AS 'COD COMPRADOR SC', 
	CASE WHEN SC1010.C1_CODCOMP IN ('117','205','157','150','012','217','068','017','179','237','096','010','244','152','245') THEN 'COMPRA CORPORATIVA' ELSE 'COMPRA LOCAL'  END AS 'LOCAL DE COMPRA',
	RTRIM(SY1010.Y1_NOME) AS 'NOME COMPRADOR SC',
	SC1010.C1_CLVL AS 'OBRA/PROJETO', 
	RTRIM(SC1010.C1_CLVL+' - '+CTH010.CTH_DESC01) AS 'DESC OBRA/PROJETO',
	SC1010.C1_FILENT AS 'FILIAL DE ENTREGA', 
	CASE WHEN SC1010.C1_RESIDUO = ' ' THEN 'NÃO' ELSE 'SIM'  END AS 'ELIMINADO POR RESÍDUO?', 
	CASE WHEN SC1010.C1_APROV = 'B' THEN 'BLOQUEADA' WHEN SC1010.C1_APROV = 'L' THEN 'LIBERADA' ELSE 'REJEITADA'  END AS 'SC APROVADA?', 
	SC1010.C1_ALTMOT AS 'MOT ALT',
	SC1010.C1_MOTIVO AS 'MOTIVO DE REJEIÇÃO',  
	SC1010.C1_HORINCL AS 'HORA INCLUSÃO',

	SC1010.C1_APROV1 AS 'APROVADOR 1', 
	SC1010.C1_APROV2 AS 'APROVADOR 2', 
	SC1010.C1_APROV3 AS 'APROVADOR 3', 
	SC1010.C1_APROV4 AS 'APROVADOR 4', 
	SC1010.C1_APROV5 AS 'APROVADOR 5', 
	SC1010.C1_APROV6 AS 'APROVADOR 6', 
	SC1010.C1_APROV7 AS 'APROVADOR 7', 
	
	Case RTrim(Coalesce(SC1010.C1_DTLIB1,'')) WHEN ''  THEN Null ELSE convert(datetime, SC1010.C1_DTLIB1, 112)END AS 'DT LIBERADO1',
	Case RTrim(Coalesce(SC1010.C1_DTLIB2,'')) WHEN ''  THEN Null ELSE convert(datetime, SC1010.C1_DTLIB2, 112)END AS 'DT LIBERADO2',
	Case RTrim(Coalesce(SC1010.C1_DTLIB3,'')) WHEN ''  THEN Null ELSE convert(datetime, SC1010.C1_DTLIB3, 112)END AS 'DT LIBERADO3',
	Case RTrim(Coalesce(SC1010.C1_DTLIB4,'')) WHEN ''  THEN Null ELSE convert(datetime, SC1010.C1_DTLIB4, 112)END AS 'DT LIBERADO4',
	Case RTrim(Coalesce(SC1010.C1_DTLIB5,'')) WHEN ''  THEN Null ELSE convert(datetime, SC1010.C1_DTLIB5, 112)END AS 'DT LIBERADO5',
	Case RTrim(Coalesce(SC1010.C1_DTLIB6,'')) WHEN ''  THEN Null ELSE convert(datetime, SC1010.C1_DTLIB6, 112)END AS 'DT LIBERADO6',
	Case RTrim(Coalesce(SC1010.C1_DTLIB7,'')) WHEN ''  THEN Null ELSE convert(datetime, SC1010.C1_DTLIB7, 112)END AS 'DT LIBERADO7',

	Case RTrim(Coalesce(SC1010.C1_EMISSAO,'')) WHEN ''  THEN Null ELSE convert(datetime, SC1010.C1_EMISSAO, 112)END AS 'EMISSÃO',
	Case RTrim(Coalesce(SC1010.C1_ALTDATA,'')) WHEN ''  THEN Null ELSE convert(datetime, SC1010.C1_ALTDATA, 112)END AS 'DT ALT',
	
	SC1010.C1_LIBOK1 AS 'LIBERADO 1', 
	SC1010.C1_LIBOK2 AS 'LIBERADO 2', 
	SC1010.C1_LIBOK3 AS 'LIBERADO 3', 
	SC1010.C1_LIBOK4 AS 'LIBERADO 4', 
	SC1010.C1_LIBOK5 AS 'LIBERADO 5', 
	SC1010.C1_LIBOK6 AS 'LIBERADO 6', 
	SC1010.C1_LIBOK7 AS 'LIBERADO 7',
	
	CASE 
		WHEN SB1010.B1_GRUPO IN ('0229','0096','0211','0012','0013','0014','0052','0053','0054','0090','0091','0092','0093','0094','0095','0098','0099','0755','1021','4004','4005','4010','1023','1026','0097') 
			THEN 'FROTA' 
		WHEN SB1010.B1_GRUPO IN ('0212','0050','0051','0130','0131','0132','0133','0250','0251','0252','0253','0255','0256','0257','0704','0713','0714','0716','4003','4008') 
			THEN 'SUPRIMENTOS' 
		WHEN SB1010.B1_GRUPO IN ('0223','0170','0171','0172','0173','0175','0176','0177','0216','0701','0709','0711','0712','0717','0718','0719','0740','0747','0748','0754','0756','0860','0861','0863','0864','0980','0982','0983','1020','4007','4009','0758','1028','1027','0984','0985') 
			THEN 'ADMINISTRATIVO' 
		ELSE 'ERRO' 
	END AS 'DEPARTAMENTO',
	
	CASE WHEN SC1010.C1_CLVL = '001      ' THEN 'INVESTIMENTO' ELSE 'CUSTO' END AS 'INVEST-CUST', 
	CASE WHEN SC1010.C1_TPCOMPR='2' THEN 'APLICAÇÃO DIRETA' WHEN SC1010.C1_TPCOMPR='1' THEN 'ESTOQUE' END AS 'TIPO DE COMPRA '
	
FROM PROTHEUS.dbo.SC1010 SC1010
	LEFT JOIN PROTHEUS.dbo.Z01010 Z01010 ON Z01010.Z01_CODGER = (SC1010.C1_FILIAL + SC1010.C1_LOCAL)
	LEFT JOIN PROTHEUS.dbo.CTT010 CTT010 ON SC1010.C1_CC=CTT010.CTT_CUSTO
	LEFT JOIN PROTHEUS.dbo.CT1010 CT1010 ON SC1010.C1_CONTA=CT1010.CT1_CONTA
	LEFT JOIN PROTHEUS.dbo.CTH010 CTH010 ON SC1010.C1_CLVL=CTH010.CTH_CLVL
	LEFT JOIN PROTHEUS.dbo.CTD010 CTD010 ON SC1010.C1_ITEMCTA=CTD010.CTD_ITEM
	LEFT JOIN PROTHEUS.dbo.SY1010 SY1010 ON SC1010.C1_CODCOMP=SY1010.Y1_COD
	LEFT JOIN PROTHEUS.dbo.SB1010 SB1010 ON SC1010.C1_PRODUTO=SB1010.B1_COD
	LEFT JOIN PROTHEUS.dbo.SBM010 SBM010 ON SB1010.B1_GRUPO=SBM010.BM_GRUPO
WHERE
	(SC1010.D_E_L_E_T_<>'*') 
	AND (SC1010.C1_EMISSAO>='20170101' AND SC1010.C1_EMISSAO<=GETDATE())
	AND (SC1010.C1_RESIDUO<> ' ')
-- 	AND SC1010.C1_QUJE<SC1010.C1_QUANT
	AND SC1010.C1_FILIAL = '12'
	AND SC1010.C1_LOCAL = '90'
	--GRUPOS QUE NÃO PERTENCEM À ANÁLISE (GERALMENTE PARTENCENTES AO RH)
	(SB1010.B1_GRUPO NOT IN ('3061','3058','1214','1221','1061','1220','3003','3001','0702','1200','1219','0710','3002','0720','3004','3050','3006','0703','1024','0700','1218','1203','1211','1205','1202','1204','0752','4006','3007','0820','0823','3005','0743','1206','0174','1022','3060','0781','1213','1215','1065','1208','3000','0825')) AND
	AND (SC1010.C1_APROV='L') --OR SC1010.C1_APROV='B')
	--AND SC1010.C1_CLVL <> '001'
ORDER BY
	SC1010.C1_NUM,
	SC1010.C1_ITEM
