SELECT 
	RTRIM(SC1010.C1_ITEMCTA+' - '+CTD010.CTD_DESC01) AS 'DESC CARRO',
	Case RTrim(Coalesce(SC1010.C1_EMISSAO,'')) WHEN ''  THEN Null ELSE convert(datetime, SC1010.C1_EMISSAO, 112)END AS 'EMISSÃO SC',
	CASE WHEN SC1010.C1_APROV = 'B' THEN 'BLOQUEADA' WHEN SC1010.C1_APROV = 'L' THEN 'LIBERADA' ELSE 'REJEITADA'  END AS 'SC APROVADA?', 
	SC1010.C1_FILIAL+SC1010.C1_LOCAL+' - '+Z01010.Z01_DESC AS 'DESCRIÇÃO LOCAL',
	SC1010.C1_NUM AS 'NUM SC', 
	SC1010.C1_ITEM AS 'ITEM', 
	SC1010.C1_OBS AS 'OBSERVAÇÃO', 
	RTRIM(SC1010.C1_PRODUTO) AS 'CODIGO', 
	RTRIM(SC1010.C1_DESCRI) AS 'DESCRIÇÃO',
	SC1010.C1_UM AS 'UND', 
	SC1010.C1_QUANT AS 'QTDE SC', 
	SC1010.C1_VLESTIM AS 'VAL UND',
	SC1010.C1_VTOTAL AS 'TOTAL SC', 
	
	SC7010.C7_QUANT AS 'QTDE EM PC',
	SC7010.C7_TOTAL AS 'VAL EM PC',
	
	SC7010.C7_QUJE+SC7010.C7_QTDACLA AS 'QTD RECEBIDO PC',
	(SC7010.C7_QUJE+SC7010.C7_QTDACLA)*SC7010.C7_PRECO AS 'TOTAL RECEBIDO PC',
	
	(SC1010.C1_QUANT-SC1010.C1_QUJE) AS 'QTDE FALTA',
	(SC1010.C1_QUANT-SC1010.C1_QUJE)*SC1010.C1_VLESTIM AS 'VAL FALTA',
	
	SC7010.C7_NUM AS 'NUM PC',
	SC7010.C7_ITEM AS 'ITEM PC',
	CASE WHEN SC7010.C7_CONAPRO = 'L' THEN 'APROVADO' ELSE 'BLOQUEADO' END AS 'SITUAÇÃO PC',
	Case RTrim(Coalesce(SC7010.C7_EMISSAO,'')) WHEN ''  THEN Null ELSE convert(datetime, SC7010.C7_EMISSAO, 112)END AS 'EMISSÃO PC',
	SC7010.C7_FORNECE+' - '+SC7010.C7_NOMFOR AS 'NOME FORNECEDOR',
	
	CASE 
		WHEN SC7010.C7_QUJE=SC7010.C7_QUANT THEN 'RECEBIDO TOTALMENTE'
		WHEN SC7010.C7_QUJE=0 THEN 'FALTA RECEBER'
		WHEN SC7010.C7_QUJE<SC7010.C7_QUANT AND SC7010.C7_QUJE>0 THEN 'RECEBIDO PARCIAL'
		ELSE 'ERRO'
	END AS 'SITUAÇÃO DO PC',
	
	CASE WHEN (SC1010.C1_QUANT-SC1010.C1_QUJE)=0 THEN 'FINALIZADA' WHEN (SC1010.C1_QUANT-SC1010.C1_QUJE)>0 THEN 'PENDENTE' ELSE 'ERRO' END AS 'SITUAÇÃO COMPRA',
	RTRIM(SB1010.B1_GRUPO+' - '+SBM010.BM_DESC) AS 'DESCRIÇÃO DE GRUPO',
	CASE WHEN SC1010.C1_CC = '          ' THEN 'PARA ARMAZÉM' ELSE 'APLICAÇÃO DIRETA' END AS 'TIPO DE COMPRA',
	CASE WHEN SC1010.C1_CC = '          ' THEN 'PROCESSO PARA ARMAZÉM' ELSE RTRIM(SC1010.C1_CC+' - '+CTT010.CTT_DESC01) END AS 'DESCRIÇÃO CENTRO DE CUSTO', 
	
	SC1010.C1_USER+' - '+SC1010.C1_SOLICIT AS 'SOLICITANTE DA SC',  
	CASE WHEN SC1010.C1_CODCOMP IN ('117','205','157','150','012','217','068','017','179','237','096','010','244','152','245') THEN 'COMPRA CORPORATIVA' ELSE 'COMPRA LOCAL'  END AS 'LOCAL DE COMPRA',
	RTRIM(SC1010.C1_CODCOMP+' - '+SY1010.Y1_NOME) AS 'NOME COMPRADOR SC',
	
	RTRIM(SC1010.C1_CLVL+' - '+CTH010.CTH_DESC01) AS 'DESCRIÇÃO OBRA/PROJETO',
	SC1010.C1_FILENT AS 'FILIAL DE ENTREGA', 

	RTRIM(SC1010.C1_ALTMOT) AS 'MOTIVO ALTERAÇÃO',
	RTRIM(SC1010.C1_MOTIVO) AS 'MOTIVO DE REJEIÇÃO',  

	Case RTrim(Coalesce(SC1010.C1_DTLIB1,'')) WHEN ''  THEN Null ELSE convert(datetime, SC1010.C1_DTLIB1, 112)END AS 'DT LIBERADO1',
	Case RTrim(Coalesce(SC1010.C1_DTLIB2,'')) WHEN ''  THEN Null ELSE convert(datetime, SC1010.C1_DTLIB2, 112)END AS 'DT LIBERADO2',
	Case RTrim(Coalesce(SC1010.C1_DTLIB3,'')) WHEN ''  THEN Null ELSE convert(datetime, SC1010.C1_DTLIB3, 112)END AS 'DT LIBERADO3',
	Case RTrim(Coalesce(SC1010.C1_DTLIB4,'')) WHEN ''  THEN Null ELSE convert(datetime, SC1010.C1_DTLIB4, 112)END AS 'DT LIBERADO4',
	Case RTrim(Coalesce(SC1010.C1_DTLIB5,'')) WHEN ''  THEN Null ELSE convert(datetime, SC1010.C1_DTLIB5, 112)END AS 'DT LIBERADO5',
	Case RTrim(Coalesce(SC1010.C1_DTLIB6,'')) WHEN ''  THEN Null ELSE convert(datetime, SC1010.C1_DTLIB6, 112)END AS 'DT LIBERADO6',
	Case RTrim(Coalesce(SC1010.C1_DTLIB7,'')) WHEN ''  THEN Null ELSE convert(datetime, SC1010.C1_DTLIB7, 112)END AS 'DT LIBERADO7',

	Case RTrim(Coalesce(SC1010.C1_ALTDATA,'')) WHEN ''  THEN Null ELSE convert(datetime, SC1010.C1_ALTDATA, 112)END AS 'DT ALT',
	
	CASE 
		WHEN SB1010.B1_GRUPO IN ('0229','0096','0211','0012','0013','0014','0052','0053','0054','0090','0091','0092','0093','0094','0095','0098','0099','0755','1021','4004','4005','4010','1023','1026','0097') 
			THEN 'FROTA' 
		WHEN SB1010.B1_GRUPO IN ('0212','0050','0051','0130','0131','0132','0133','0250','0251','0252','0253','0255','0256','0257','0704','0713','0714','0716','4003','4008') 
			THEN 'SUPRIMENTOS' 
		WHEN SB1010.B1_GRUPO IN ('0223','0170','0171','0172','0173','0175','0176','0177','0216','0701','0709','0711','0712','0717','0718','0719','0740','0747','0748','0754','0756','0860','0861','0863','0864','0980','0982','0983','1020','4007','4009','0758','1028','1027','0984','0985') 
			THEN 'ADMINISTRATIVO' 
		ELSE 'ERRO' 
	END AS 'DEPARTAMENTO',
	
	CASE WHEN SC1010.C1_CLVL = '001      ' THEN 'INVESTIMENTO' ELSE 'CUSTO' END AS 'INVEST-CUST'
	
FROM PROTHEUS.dbo.SC1010 SC1010
	LEFT JOIN PROTHEUS.dbo.Z01010 Z01010 ON Z01010.Z01_CODGER = (SC1010.C1_FILIAL + SC1010.C1_LOCAL)
	LEFT JOIN PROTHEUS.dbo.CTT010 CTT010 ON SC1010.C1_CC=CTT010.CTT_CUSTO
	LEFT JOIN PROTHEUS.dbo.CT1010 CT1010 ON SC1010.C1_CONTA=CT1010.CT1_CONTA
	LEFT JOIN PROTHEUS.dbo.CTH010 CTH010 ON SC1010.C1_CLVL=CTH010.CTH_CLVL
	LEFT JOIN PROTHEUS.dbo.CTD010 CTD010 ON SC1010.C1_ITEMCTA=CTD010.CTD_ITEM
	LEFT JOIN PROTHEUS.dbo.SY1010 SY1010 ON SC1010.C1_CODCOMP=SY1010.Y1_COD
	LEFT JOIN PROTHEUS.dbo.SB1010 SB1010 ON SC1010.C1_PRODUTO=SB1010.B1_COD
	LEFT JOIN PROTHEUS.dbo.SBM010 SBM010 ON SB1010.B1_GRUPO=SBM010.BM_GRUPO
	LEFT JOIN PROTHEUS.dbo.SC7010 SC7010 ON SC1010.C1_NUM=SC7010.C7_NUMSC AND SC1010.C1_ITEM=SC7010.C7_ITEMSC
WHERE
	(SC1010.D_E_L_E_T_<>'*') 
	AND (SC1010.C1_RESIDUO= ' ') 
	AND (SC1010.C1_APROV='L' OR SC1010.C1_APROV='B') 
	AND (SC7010.C7_ITEMCTA Like '%'+?+'%')
ORDER BY
	SC1010.C1_NUM,
	SC1010.C1_ITEM