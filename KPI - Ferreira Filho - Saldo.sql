SELECT 
	Z01010.Z01_CODGER AS 'COD GERAL',
	SB2010.B2_FILIAL AS 'FILIAS', 
	SB2010.B2_LOCAL AS 'ARMAZÉM', 
	Z01010.Z01_DESC AS 'DESCRIÇÃO ARMAZÉM',
	SB2010.B2_VATU1 AS 'VALOR EM ESTOQUE - SISTEMA',
	CASE WHEN SB2010.B2_VATU1>0 THEN 'POSITIVO' WHEN SB2010.B2_VATU1<0 THEN 'NEGATIVO' ELSE 'ZERO' END AS 'TIPO SALDO - SISTEMA',
	(PRODUTO.ULTIMO_PREÇO*SB2010.B2_QATU) AS 'VALOR EM ESTOQUE - ULT PREC COMPR',
	CASE WHEN (PRODUTO.ULTIMO_PREÇO*SB2010.B2_QATU)>0 THEN 'POSITIVO' WHEN (PRODUTO.ULTIMO_PREÇO*SB2010.B2_QATU)<0 THEN 'NEGATIVO' ELSE 'ZERO' END AS 'TIPO SALDO - ULT. PREÇ COMPRA'
FROM PROTHEUS.dbo.SB2010 SB2010
	LEFT JOIN PROTHEUS.dbo.Z01010 Z01010 ON Z01010.Z01_CODGER = (SB2010.B2_FILIAL+SB2010.B2_LOCAL)
	LEFT JOIN 
		(
			SELECT 
				SB1010.B1_COD AS CODIGO,
				SB1010.B1_UPRC AS ULTIMO_PREÇO
			FROM PROTHEUS.dbo.SB1010 SB1010
			WHERE
				(SB1010.D_E_L_E_T_<>'*')
		) AS PRODUTO ON SB2010.B2_COD=PRODUTO.CODIGO
WHERE 
	(SB2010.B2_QATU<>'0') AND
	(SB2010.D_E_L_E_T_<>'*') AND
	Z01010.Z01_MSBLQL = 2 AND
	Z01010.Z01_TME = '001'