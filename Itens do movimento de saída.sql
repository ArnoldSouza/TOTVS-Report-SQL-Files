SELECT

	SD2010.D2_FILIAL+SD2010.D2_LOCAL+' - '+Z01010.Z01_DESC AS 'DESCRIÇÃO ARMAZÉM',
	CASE WHEN SF4010.F4_ESTOQUE = 'S' THEN 'SIM' ELSE 'NÃO' END AS 'ATUALIZOU ESTOQUE?',	
	CASE WHEN SD2010.D2_TIPO = 'D' THEN 'DEVOLUÇÃO' ELSE 'SAÍDA' END AS 'TIPO MOV', 
	SD2010.D2_COD AS 'CODIGO',
	RTRIM(SB1010.B1_DESC) AS 'DESCRIÇÃO',
	SD2010.D2_ITEM AS 'ITEM',
	SD2010.D2_UM AS 'UND',
	CASE WHEN SD2010.D2_TIPO = 'D' THEN SD2010.D2_QUANT*-1 ELSE SD2010.D2_QUANT END AS 'QTDE', 
	SD2010.D2_PRCVEN AS 'PREÇ. VENDA',
	CASE WHEN SD2010.D2_TIPO = 'D' THEN SD2010.D2_TOTAL*-1 ELSE SD2010.D2_TOTAL END AS 'TOTAL', 
	SD2010.D2_TES AS 'TES',
	SF4010.F4_TEXTO AS 'DESC TES',
	SD2010.D2_CF AS 'CFOP',
	SD2010.D2_PESO AS 'PESO',
	SD2010.D2_PEDIDO AS 'NUM PV',
	SD2010.D2_ITEMPV AS 'ITEM PV',
	SD2010.D2_DOC AS 'DOCUMENTO',
	SD2010.D2_SERIE 'SERIE',
	SD2010.D2_CLIENTE AS 'CLIENTE',
	
	CASE WHEN SD2010.D2_TIPO = 'D' THEN SA2010.A2_NREDUZ ELSE SA1010.A1_NREDUZ END AS 'NOME CLIENTE',
	CASE WHEN SD2010.D2_TIPO = 'D' THEN SA2010.A2_TIPO ELSE SA1010.A1_PESSOA END AS 'PESSOA JUR\FIS',
	CASE WHEN SD2010.D2_TIPO = 'D' THEN SA2010.A2_CGC ELSE SA1010.A1_CGC END AS 'CNPJ\CPF',
	
	SD2010.D2_LOJA AS 'LOJA',
	SD2010.D2_GRUPO AS 'GRUPO',
	Case RTrim(Coalesce(SD2010.D2_EMISSAO,'')) WHEN ''  THEN Null ELSE convert(datetime,SD2010.D2_EMISSAO, 112)END AS 'DT EMISSÃO',
	SD2010.D2_EST AS 'EST. DEST.',
	SD2010.D2_TIPO AS 'TIPO NF',
	SD2010.D2_ESTOQUE AS 'MOV. ESTOQUE',
	SD2010.D2_NFORI AS 'NF DA DEVOLUÇÃO',
	SC5010.C5_USUINL AS 'USUARIO DO PV',
	SC5010.C5_MENNOTA AS 'MSG P/NOTA'

FROM PROTHEUS.dbo.SD2010 SD2010
	LEFT JOIN PROTHEUS.dbo.SF4010 SF4010 ON SF4010.F4_CODIGO=SD2010.D2_TES
	LEFT JOIN PROTHEUS.dbo.Z01010 Z01010 ON Z01010.Z01_CODGER=(SD2010.D2_FILIAL+SD2010.D2_LOCAL)
	LEFT JOIN PROTHEUS.dbo.SB1010 SB1010 ON SB1010.B1_COD=SD2010.D2_COD 
	LEFT JOIN PROTHEUS.dbo.SA1010 SA1010 ON SA1010.A1_COD=SD2010.D2_CLIENTE
	LEFT JOIN PROTHEUS.dbo.SA2010 SA2010 ON SA2010.A2_COD=SD2010.D2_CLIENTE
	LEFT JOIN PROTHEUS.dbo.SC5010 SC5010 ON SC5010.C5_NUM=SD2010.D2_PEDIDO AND SD2010.D2_FILIAL=SC5010.C5_FILIAL

WHERE 
	SD2010.D_E_L_E_T_<>'*' 
	AND SA1010.A1_CGC LIKE '%04038198308%'
	--(SD2010.D2_EMISSAO>='20160101' AND SD2010.D2_EMISSAO<='20161130')AND
	--(SD2010.D2_FILIAL='02' AND SD2010.D2_LOCAL='01') AND
	--SF4010.F4_ESTOQUE='S'