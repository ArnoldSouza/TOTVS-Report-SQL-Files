SELECT
	
	SD1010.D1_FILIAL+SD1010.D1_LOCAL+'-'+Z01010.Z01_DESC AS 'DESCRIÇÃO ARMAZÉM',
	SD1010.D1_TES AS 'TES', 
	SF4010.F4_TEXTO AS 'DESCRIÇÃO TES',
	SD1010.D1_CC AS 'CENTRO DE CUSTO-PN',
	SF4010.F4_ESTOQUE AS 'ATU. ESTOQUE',
	SF4010.F4_ATUATF AS 'ATU. ATIVO',
	SF4010.F4_CF AS 'CFOP',
	SX5010.X5_DESCRI AS 'DESCRIÇÃO CFOP',
	SD1010.D1_DOC AS 'DOCUMENTO',
	SD1010.D1_ITEM AS 'ITEM',
	SD1010.D1_COD AS 'CODIGO',
	SD1010.D1_DESCRI AS 'DESCRIÇÃO',
	SD1010.D1_UM AS 'UND',
	SD1010.D1_QUANT AS 'QTDE DOC',
	SD1010.D1_VUNIT	AS 'VAL UND',
	SD1010.D1_TOTAL AS 'VAL TOTAL',
	CASE WHEN SD1010.D1_TES = '   ' THEN 'NÃO CLASSIFICADA' ELSE 'CLASSIFICADA' END AS 'CLASSIFICAÇÃO',	
	SF1010.F1_NMCLASS AS 'USUÁRIO CLASSIFICOU',
	SD1010.D1_CONTA AS 'CONTA CONTÁBIL',
	CASE WHEN SD1010.D1_CONTA = '                    ' THEN 'ATIVO FIXO' ELSE RTRIM(CT1010.CT1_DESC01) END AS 'DESC CONT CONTÁBIL',
	CASE WHEN SD1010.D1_CC = '         ' THEN 'PROCESSO PARA ARMAZÉM' ELSE RTRIM(CTT010.CTT_DESC01) END AS 'DESCRIÇÃO CENTRO DE CUSTO', 
	SD1010.D1_PEDIDO AS 'NUM PEDIDO',
	SD1010.D1_ITEMPC AS 'ITEM PEDIDO',
	
	SC7010.C7_NUMSC AS 'NUM SC',
	SC7010.C7_ITEMSC AS 'ITEM SC', 
	SC1010.C1_SOLICIT AS 'NOME SOLICITANTE SC',  
	SC1010.C1_TPCOMPR AS 'TIPO DE COMPRA',
	SC1010.C1_CC AS 'CENTRO DE CUSTO-SC',
	
	SD1010.D1_QTDPEDI AS 'QTDE PEDIDO',
	SD1010.D1_FORNECE AS 'FORNECEDOR',
	CASE WHEN SD1010.D1_FORNECE = '      ' THEN '' ELSE RTRIM(SA2010.A2_NOME)  END AS 'NOME FORNECEDOR',
	
	-- SB1010.B1_GRUPO AS 'COD GRUPO',
	-- RTRIM(SBM010.BM_DESC) AS 'DESC GRUPO',
	
	Case RTrim(Coalesce(SD1010.D1_EMISSAO,'')) WHEN ''  THEN Null ELSE convert(datetime,SD1010.D1_EMISSAO, 112)END AS 'DT EMISSÃO',
	Case RTrim(Coalesce(SD1010.D1_DTDIGIT,'')) WHEN ''  THEN Null ELSE convert(datetime,SD1010.D1_DTDIGIT, 112)END AS 'DT DIGITAÇÃO',
	Case RTrim(Coalesce(SF1010.F1_DTINCL,'')) WHEN ''  THEN Null ELSE convert(datetime,SF1010.F1_DTINCL, 112)END AS 'DT INCLUSÃO',
	Case RTrim(Coalesce(SF1010.F1_DTLANC,'')) WHEN ''  THEN Null ELSE convert(datetime,SF1010.F1_DTLANC, 112)END AS 'DT CLASSIFICAÇÃO',
	Case RTrim(Coalesce(SF1010.F1_RECBMTO,'')) WHEN ''  THEN Null ELSE convert(datetime,SF1010.F1_RECBMTO, 112)END AS 'DT RECEBIMENTO',
	SD1010.D1_CLVL AS 'COD DE OBRA',
	RTRIM(SD1010.D1_CLVL+' - '+CTH010.CTH_DESC01) AS 'DESC OBRA/PROJETO',
	SD1010.D1_SERIE AS 'SERIE',
	SD1010.D1_LOJA  AS 'LOJA',
	SF1010.F1_NMUSER AS 'USUÁRIO INCLUIU PRENOTA'
	
FROM PROTHEUS.dbo.SD1010 SD1010
	LEFT JOIN PROTHEUS.dbo.Z01010 Z01010 ON Z01010.Z01_CODGER = (SD1010.D1_FILIAL+SD1010.D1_LOCAL)
	LEFT JOIN PROTHEUS.dbo.CT1010 CT1010 ON SD1010.D1_CONTA=CT1010.CT1_CONTA
	LEFT JOIN PROTHEUS.dbo.CTT010 CTT010 ON SD1010.D1_CC=CTT010.CTT_CUSTO
	LEFT JOIN PROTHEUS.dbo.CTH010 CTH010 ON SD1010.D1_CLVL=CTH010.CTH_CLVL
	LEFT JOIN PROTHEUS.dbo.SA2010 SA2010 ON SD1010.D1_FORNECE=SA2010.A2_COD
	LEFT JOIN PROTHEUS.dbo.SF1010 SF1010 ON (SD1010.D1_DOC+SD1010.D1_SERIE+SD1010.D1_FORNECE+SD1010.D1_LOJA)=(SF1010.F1_DOC+SF1010.F1_SERIE+SF1010.F1_FORNECE+SF1010.F1_LOJA)
	LEFT JOIN PROTHEUS.dbo.SF4010 SF4010 ON SF4010.F4_CODIGO=SD1010.D1_TES
	LEFT JOIN PROTHEUS.dbo.SX5010 SX5010 ON SX5010.X5_TABELA='13' AND SX5010.X5_CHAVE=SF4010.F4_CF
	LEFT JOIN PROTHEUS.dbo.SC7010 SC7010 ON (SD1010.D1_PEDIDO=SC7010.C7_NUM AND SD1010.D1_ITEMPC=SC7010.C7_ITEM)
	LEFT JOIN PROTHEUS.dbo.SC1010 SC1010 ON (SC7010.C7_NUMSC=SC1010.C1_NUM AND SC7010.C7_ITEMSC=SC1010.C1_ITEM)
	
	
	-- LEFT JOIN PROTHEUS.dbo.SB1010 SB1010 ON SD1010.D1_COD=SB1010.B1_COD
	-- LEFT JOIN PROTHEUS.dbo.SBM010 SBM010 ON SB1010.B1_GRUPO=SBM010.BM_GRUPO
	
WHERE 
	-- (SD1010.D1_CC='') AND 
	(SD1010.D1_DTDIGIT>='20160101') AND (SD1010.D1_DTDIGIT<='20161130') AND  
	(SD1010.D_E_L_E_T_<>'*') AND
	(
	
	(SD1010.D1_CC = '         ' AND SF4010.F4_ESTOQUE='N' AND SF4010.F4_TPTES<>'02') OR 
	
	(SD1010.D1_CC <> '         ' AND SF4010.F4_ESTOQUE='S' AND SF4010.F4_TPTES<>'01') OR
	
	(SD1010.D1_CC = '         ' AND SF4010.F4_ESTOQUE='N' AND SF4010.F4_TPTES='02')
	
	)

