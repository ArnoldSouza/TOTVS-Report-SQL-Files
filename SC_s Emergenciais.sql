SELECT *
FROM
	(
		SELECT 
			SC1010.C1_FILIAL AS 'FILIAL', 
			SC1010.C1_LOCAL AS 'ARMAZÉM',
			SC1010.C1_FILIAL+SC1010.C1_LOCAL+' - '+Z01010.Z01_DESC AS 'DESCRIÇÃO ARMAZÉM',
			Case RTrim(Coalesce(SC1010.C1_EMISSAO,'')) WHEN ''  THEN Null ELSE convert(datetime, SC1010.C1_EMISSAO, 112)END AS 'EMISSÃO',
			SC1010.C1_NUM AS NUMSC, 
			SC1010.C1_ITEM AS ITEM, 
			RTRIM(SC1010.C1_PRODUTO) AS 'CODIGO', 
			RTRIM(SC1010.C1_DESCRI) AS 'DESCRIÇÃO',
			SC1010.C1_UM AS 'UND', 
			SC1010.C1_QUANT AS 'QTDE', 
			SC1010.C1_VLESTIM AS 'VAL. UND.',
			SC1010.C1_VTOTAL AS 'VAL TOTAL', 
			SC1010.C1_TOTSC AS 'VAL TOTAL SC',
			SC1010.C1_QUJE AS 'QTDE EM PEDIDO',
			(SC1010.C1_QUANT-SC1010.C1_QUJE) AS 'QTDE FALTA',
			(SC1010.C1_QUANT-SC1010.C1_QUJE)*SC1010.C1_VLESTIM AS 'VAL FALTA',
			SB1010.B1_GRUPO AS 'COD GRUPO',
			RTRIM(SBM010.BM_DESC) AS 'DESC GRUPO',
			Case RTrim(Coalesce(SC1010.C1_DATPRF,'')) WHEN ''  THEN Null ELSE convert(datetime, SC1010.C1_DATPRF, 112)END AS 'DT NECESSIDADE',
			SC1010.C1_OBS AS 'OBSERVAÇÃO', 
			CASE WHEN SC1010.C1_CC = '          ' THEN 'PARA ARMAZÉM' ELSE 'APLICAÇÃO DIRETA' END AS 'TIPO DE COMPRA',
			SC1010.C1_CC AS 'CENTRO DE CUSTO', 
			CASE WHEN SC1010.C1_CC = '          ' THEN 'PROCESSO PARA ARMAZÉM' ELSE RTRIM(CTT010.CTT_DESC01) END AS 'DESCRIÇÃO CENTRO DE CUSTO', 
			SC1010.C1_CONTA AS 'CONTA CONTÁBIL',
			CASE WHEN SC1010.C1_CONTA = '                    ' THEN 'ATIVO FIXO' ELSE RTRIM(CT1010.CT1_DESC01) END AS 'DESC CONT CONTÁBIL',
			SC1010.C1_ITEMCTA AS 'CARRO',
			RTRIM(SC1010.C1_ITEMCTA+' - '+CTD010.CTD_DESC01) AS 'DESC CARRO',
			SC1010.C1_FORNECE AS 'FORNECEDOR', 
			CASE WHEN SC1010.C1_FORNECE = '      ' THEN '' ELSE RTRIM(SA2010.A2_NOME)  END AS 'NOME FORNECEDOR',
			SC1010.C1_PEDIDO AS 'NUM PC', 
			SC1010.C1_ITEMPED AS 'ITEM PC',
			SC1010.C1_USER AS 'COD SOLICITANTE SC',  
			SC1010.C1_SOLICIT AS 'NOME SOLICITANTE SC',  
			SC1010.C1_CODCOMP AS 'COD COMPRADOR SC', 
			CASE WHEN SC1010.C1_CODCOMP IN ('117','205','157','150','012','217','068','017','179') THEN 'COMPRA CORPORATIVA' ELSE 'COMPRA LOCAL'  END AS 'LOCAL DE COMPRA',
			RTRIM(SY1010.Y1_NOME) AS 'NOME COMPRADOR SC',
			SC1010.C1_CLVL AS 'OBRA/PROJETO', 
			RTRIM(SC1010.C1_CLVL+' - '+CTH010.CTH_DESC01) AS 'DESC OBRA/PROJETO',
			SC1010.C1_FILENT AS 'FILIAL DE ENTREGA', 
			CASE WHEN SC1010.C1_RESIDUO = ' ' THEN 'NÃO' ELSE 'SIM'  END AS 'ELIMINADO POR RESÍDUO?', 
			CASE WHEN SC1010.C1_APROV = 'B' THEN 'BLOQUEADA' ELSE 'APROVADA - PENDENTE DE COMPRA'  END AS 'SC APROVADA?', 
			Case RTrim(Coalesce(SC1010.C1_ALTDATA,'')) WHEN ''  THEN Null ELSE convert(datetime, SC1010.C1_ALTDATA, 112)END AS 'DT ALT',
			SC1010.C1_ALTMOT AS 'MOT ALT',
			SC1010.C1_MOTIVO AS 'MOTIVO DE REJEIÇÃO',  
			SC1010.C1_HORINCL AS 'HORA INCLUSÃO',

			SC1010.C1_APROV1 AS 'APROVADOR 1', 
			SC1010.C1_APROV2 AS 'APROVADOR 2', 
			SC1010.C1_APROV3 AS 'APROVADOR 3', 
			SC1010.C1_APROV4 AS 'APROVADOR 4', 
			SC1010.C1_APROV5 AS 'APROVADOR 5', 
			SC1010.C1_APROV6 AS 'APROVADOR 6', 
			SC1010.C1_APROV7 AS 'APROVADOR 7', 
				
			/* (SELECT SY1010.Y1_NOME FROM PROTHEUS.dbo.SY1010 SY1010 WHERE SC1010.C1_APROV1=SY1010.Y1_USER) AS 'NOME APROV 1',
			(SELECT SY1010.Y1_NOME FROM PROTHEUS.dbo.SY1010 SY1010 WHERE SC1010.C1_APROV2=SY1010.Y1_USER) AS 'NOME APROV 2',
			(SELECT SY1010.Y1_NOME FROM PROTHEUS.dbo.SY1010 SY1010 WHERE SC1010.C1_APROV3=SY1010.Y1_USER) AS 'NOME APROV 3',
			(SELECT SY1010.Y1_NOME FROM PROTHEUS.dbo.SY1010 SY1010 WHERE SC1010.C1_APROV4=SY1010.Y1_USER) AS 'NOME APROV 4',
			(SELECT SY1010.Y1_NOME FROM PROTHEUS.dbo.SY1010 SY1010 WHERE SC1010.C1_APROV5=SY1010.Y1_USER) AS 'NOME APROV 5',
			(SELECT SY1010.Y1_NOME FROM PROTHEUS.dbo.SY1010 SY1010 WHERE SC1010.C1_APROV6=SY1010.Y1_USER) AS 'NOME APROV 6',
			(SELECT SY1010.Y1_NOME FROM PROTHEUS.dbo.SY1010 SY1010 WHERE SC1010.C1_APROV7=SY1010.Y1_USER) AS 'NOME APROV 7', */
				
			Case RTrim(Coalesce(SC1010.C1_DTLIB1,'')) WHEN ''  THEN Null ELSE convert(datetime, SC1010.C1_DTLIB1, 112)END AS 'DT LIBERADO1',
			Case RTrim(Coalesce(SC1010.C1_DTLIB2,'')) WHEN ''  THEN Null ELSE convert(datetime, SC1010.C1_DTLIB2, 112)END AS 'DT LIBERADO2',
			Case RTrim(Coalesce(SC1010.C1_DTLIB3,'')) WHEN ''  THEN Null ELSE convert(datetime, SC1010.C1_DTLIB3, 112)END AS 'DT LIBERADO3',
			Case RTrim(Coalesce(SC1010.C1_DTLIB4,'')) WHEN ''  THEN Null ELSE convert(datetime, SC1010.C1_DTLIB4, 112)END AS 'DT LIBERADO4',
			Case RTrim(Coalesce(SC1010.C1_DTLIB5,'')) WHEN ''  THEN Null ELSE convert(datetime, SC1010.C1_DTLIB5, 112)END AS 'DT LIBERADO5',
			Case RTrim(Coalesce(SC1010.C1_DTLIB6,'')) WHEN ''  THEN Null ELSE convert(datetime, SC1010.C1_DTLIB6, 112)END AS 'DT LIBERADO6',
			Case RTrim(Coalesce(SC1010.C1_DTLIB7,'')) WHEN ''  THEN Null ELSE convert(datetime, SC1010.C1_DTLIB7, 112)END AS 'DT LIBERADO7',

			SC1010.C1_LIBOK1 AS 'LIBERADO 1', 
			SC1010.C1_LIBOK2 AS 'LIBERADO 2', 
			SC1010.C1_LIBOK3 AS 'LIBERADO 3', 
			SC1010.C1_LIBOK4 AS 'LIBERADO 4', 
			SC1010.C1_LIBOK5 AS 'LIBERADO 5', 
			SC1010.C1_LIBOK6 AS 'LIBERADO 6', 
			SC1010.C1_LIBOK7 AS 'LIBERADO 7',
				
			CASE 
				WHEN SB1010.B1_GRUPO IN ('0229','0096','0211','0012','0013','0014','0052','0053','0054','0090','0091','0092','0093','0094','0095','0098','0099','0755','1021','4004','4005','4010') 
					THEN 'FROTA' 
				WHEN SB1010.B1_GRUPO IN ('0212','0050','0051','0130','0131','0132','0133','0250','0251','0252','0253','0255','0256','0257','0704','0713','0714','0716','4003','4008') 
					THEN 'SUPRIMENTOS' 
				WHEN SB1010.B1_GRUPO IN ('0223','0170','0171','0172','0173','0175','0176','0177','0216','0701','0709','0711','0712','0717','0718','0719','0740','0747','0748','0754','0756','0860','0861','0863','0864','0980','0982','0983','1020','4007','4009') 
					THEN 'ADMINISTRATIVO' 
				ELSE 'ERRO' 
			END AS 'DEPARTAMENTO'
				
	FROM PROTHEUS.dbo.SC1010 SC1010
		LEFT JOIN PROTHEUS.dbo.Z01010 Z01010 ON Z01010.Z01_CODGER = (SC1010.C1_FILIAL + SC1010.C1_LOCAL)
		LEFT JOIN PROTHEUS.dbo.CTT010 CTT010 ON SC1010.C1_CC=CTT010.CTT_CUSTO
		LEFT JOIN PROTHEUS.dbo.CT1010 CT1010 ON SC1010.C1_CONTA=CT1010.CT1_CONTA
		LEFT JOIN PROTHEUS.dbo.CTH010 CTH010 ON SC1010.C1_CLVL=CTH010.CTH_CLVL
		LEFT JOIN PROTHEUS.dbo.CTD010 CTD010 ON SC1010.C1_ITEMCTA=CTD010.CTD_ITEM
		LEFT JOIN PROTHEUS.dbo.SA2010 SA2010 ON SC1010.C1_FORNECE=SA2010.A2_COD
		LEFT JOIN PROTHEUS.dbo.SY1010 SY1010 ON SC1010.C1_CODCOMP=SY1010.Y1_COD
		LEFT JOIN PROTHEUS.dbo.SB1010 SB1010 ON SC1010.C1_PRODUTO=SB1010.B1_COD
		LEFT JOIN PROTHEUS.dbo.SBM010 SBM010 ON SB1010.B1_GRUPO=SBM010.BM_GRUPO
			
	WHERE
		(SC1010.D_E_L_E_T_<>'*') AND
		(SC1010.C1_EMISSAO>='20170101') AND
		(SC1010.C1_RESIDUO= ' ') AND 
		--GRUPOS QUE NÃO PERTENCEM À ANÁLISE (GERALMENTE PARTENCENTES AO RH)
		(SB1010.B1_GRUPO NOT IN ('1060','0174','3001','3005','0702','0703','0707','0710','1024','1025','3002','3003','3007','3050','3060','0720','0752','1200','3004','1203','0700','0706','0743','0780','0781','0782','0820','0822','0823','0825','1022','1065','1202','1204','1205','1206','1208','1211','1213','1215','1219','3000','3006','3008','3054','4006','7000')) AND
			
		(SC1010.C1_APROV='L') AND

		(SC1010.C1_QUJE>0) AND
		
		(SC1010.C1_PRODUTO<>'09830005' AND SC1010.C1_PRODUTO<>'09830003' AND SC1010.C1_PRODUTO<>'09820003'AND SC1010.C1_PRODUTO<>'09820002' AND SC1010.C1_PRODUTO<>'09830005')
		
		AND
		(
			SC1010.C1_OBS LIKE '%EMERGENCIA%' OR
			SC1010.C1_OBS LIKE '%EMERGENCIAL%' OR
			SC1010.C1_OBS LIKE '%EMERGENCIALMENTE%' OR
			SC1010.C1_OBS LIKE '%EMERGENCIAU%' OR
			SC1010.C1_OBS LIKE '%EMERGENCIAUMENTE%' OR
			SC1010.C1_OBS LIKE '%URGENTE%' OR
			SC1010.C1_OBS LIKE '%URGENTEMENTE%' OR
			SC1010.C1_OBS LIKE '%URJENTE%' OR
			SC1010.C1_OBS LIKE '%URJENTEMENTE%' OR
			SC1010.C1_OBS LIKE '%MERCADO LOCAL%' OR
			SC1010.C1_OBS LIKE '%FALTA ESTOQUE%' OR
			SC1010.C1_OBS LIKE '%FALTA DE ESTOQUE%' OR
			SC1010.C1_OBS LIKE '%FALTA EM ESTOQUE%' OR
			SC1010.C1_OBS LIKE '%NAO TEM EM ESTOQUE%' OR
			SC1010.C1_OBS LIKE '%ESTOQUE BAIXO%' OR
			SC1010.C1_OBS LIKE '%COMPRA LOCAL%'
		)
	) AS A
WHERE
	(
		A."OBSERVAÇÃO" NOT LIKE '%PLANTAO EMERGENCIAL%' AND
		A."OBSERVAÇÃO" NOT LIKE '%SAV%' AND
		A."OBSERVAÇÃO" NOT LIKE '%SAV ADM%' AND
		A."OBSERVAÇÃO" NOT LIKE '%SAV LVB%' AND
		A."OBSERVAÇÃO" NOT LIKE '%SAV MAB%' AND
		A."OBSERVAÇÃO" NOT LIKE '%SAV MAR%' AND
		A."OBSERVAÇÃO" NOT LIKE '%SAV MBP%' AND
		A."OBSERVAÇÃO" NOT LIKE '%SAV MPB%' AND
		A."OBSERVAÇÃO" NOT LIKE '%SAV MPOB%' AND
		A."OBSERVAÇÃO" NOT LIKE '%SAV PLB%' AND
		A."OBSERVAÇÃO" NOT LIKE '%SERVICOS EMERGENCIAIS%' AND
		A."OBSERVAÇÃO" NOT LIKE '%SERVICOS EMERGENCIAS%' AND
		A."OBSERVAÇÃO" NOT LIKE '%TURMA DE EMERGENCIA%' AND
		A."OBSERVAÇÃO" NOT LIKE '%ACIONAMENTO DE EMERGENCIA%' AND
		A."OBSERVAÇÃO" NOT LIKE '%SALA EMERGENCIA%' AND
		A."OBSERVAÇÃO" NOT LIKE '%EMERGENCIA PESADA%' AND
		A."OBSERVAÇÃO" NOT LIKE '%VALVULAS EMERGENCIA%' AND
		A."OBSERVAÇÃO" NOT LIKE '%LUMINARIAS DE EMERGENCIA%' AND
		A."OBSERVAÇÃO" NOT LIKE '%LAMPADA DE EMERGENCIA%' AND
		A."OBSERVAÇÃO" NOT LIKE '%EQUIPES EMERGENCIA%' AND
		A."OBSERVAÇÃO" NOT LIKE '%TURMAS DE EMERGENCIA%' AND
		A."OBSERVAÇÃO" NOT LIKE '%SAIDA DE EMERGENCIA%' AND
		A."OBSERVAÇÃO" NOT LIKE '%ILUMINACOES DE EMERGENCIA%' AND
		A."OBSERVAÇÃO" NOT LIKE '%LUMINARIAS EMERGENCIAIS%' AND
		A."OBSERVAÇÃO" NOT LIKE '%VALVULA DE EMERGENCIA%' AND
		A."OBSERVAÇÃO" NOT LIKE '%SALA DE EMERGENCIA%' AND
		A."OBSERVAÇÃO" NOT LIKE '%EQUIPE EMERGENCIAL%'
	)