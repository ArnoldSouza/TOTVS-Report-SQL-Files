SELECT
	Z22010.Z22_FILIAL+Z22010.Z22_ALMORI AS 'ORIGEM',
	(
		SELECT RTRIM(Z01010.Z01_DESC)
		FROM PROTHEUS.dbo.Z01010 Z01010
		WHERE
			(Z01010.D_E_L_E_T_<>'*') AND
			Z01010.Z01_CODGER=Z22010.Z22_FILIAL+Z22010.Z22_ALMORI
	) AS 'ALMOX ORIGEM',
	
	Z22010.Z22_FILIAL+Z22010.Z22_ALMDES AS 'DESTINO',
	(
		SELECT RTRIM(Z01010.Z01_DESC)
		FROM PROTHEUS.dbo.Z01010 Z01010
		WHERE
			(Z01010.D_E_L_E_T_<>'*') AND
			Z01010.Z01_CODGER=Z22010.Z22_FILIAL+Z22010.Z22_ALMDES
	) AS 'ALMOX DESTINO',
	
	RTRIM(Z22010.Z22_PRDORI) AS 'COD PROD',

	(
		SELECT RTRIM(SB1010.B1_DESC)
		FROM PROTHEUS.dbo.SB1010 SB1010
		WHERE
			(SB1010.D_E_L_E_T_<>'*') AND
			SB1010.B1_COD=Z22010.Z22_PRDORI
	) AS 'DESCRIÇÃO',
	
	Z22010.Z22_UM AS 'UND',
	
	CASE 
		WHEN Z22010.Z22_PRDORI<>Z22010.Z22_PRDDES 
			THEN 'ERRO: PROD DEST ->'+RTRIM(Z22010.Z22_PRDDES) 
		WHEN Z22010.Z22_ALMORI=Z22010.Z22_ALMDES 
			THEN 'ERRO: ALMOX IGUAIS' 
		WHEN
			(
				SELECT
					Z01010.Z01_TME
				FROM PROTHEUS.dbo.Z01010 Z01010
				WHERE 
					Z01010.Z01_CODGER = (Z22010.Z22_FILIAL + Z22010.Z22_ALMORI)
			) <> (
				SELECT
					Z01010.Z01_TME
				FROM PROTHEUS.dbo.Z01010 Z01010
				WHERE 
					Z01010.Z01_CODGER = (Z22010.Z22_FILIAL + Z22010.Z22_ALMDES)
			)
				THEN 'ATENÇÃO: TIP ALMOX DIF'
		ELSE 
			'OK' 
	END AS 'CHECK MOV',
	
	Z22010.Z22_QUANT AS 'QTDE',
	RTRIM(Z22010.Z22_DOC) AS 'DOC TRANSF',
	RTRIM(Z22010.Z22_SD3DOC) AS 'DOC SD3: MOV INTERN',
	
	SD3010.D3_DOC AS 'DOC REAL SD3',
	RTRIM(SD3010.D3_COD) AS 'COD SD3',
	SD3010.D3_QUANT AS 'QTDE SD3',
	CAST(SD3010.D3_EMISSAO AS DATETIME) AS 'EMISSÃO SD3', 
	RTRIM(SD3010.D3_USUARIO) AS 'ALMOXARIFE',
	
	Case RTrim(Coalesce(Z22010.Z22_EMISSA,'')) WHEN ''  THEN Null ELSE convert(datetime, Z22010.Z22_EMISSA, 112)END AS 'DT EMISSÃO',
	RTRIM(Z22010.Z22_USUARI) AS 'SOLICITANTE TRANSF',
	Z22010.Z22_HORA AS 'HORA',
	Z22010.Z22_APROV AS 'APROVAÇÃO',
	RTRIM(Z22010.Z22_OBS) AS 'OBSERVAÇÃO',
	
	Z22010.Z22_APROV1 AS 'APROVADOR 1',
	Z22010.Z22_LIBOK1 AS 'LIB_OK 1',
	-- Z22010.Z22_DTLIB1
	Z22010.Z22_APROV2 AS 'APROVADOR 2',
	Z22010.Z22_LIBOK2 AS 'LIB_OK 2',
	-- Z22010.Z22_DTLIB2
	Z22010.Z22_APROV3 AS 'APROVADOR 3',
	Z22010.Z22_LIBOK3 AS 'LIB_OK 3',
	-- Z22010.Z22_DTLIB3
	
	Case RTrim(Coalesce(Z22010.Z22_DTLIB1,'')) WHEN ''  THEN Null ELSE convert(datetime, Z22010.Z22_DTLIB1, 112)END AS 'DT APROV 1',
	Case RTrim(Coalesce(Z22010.Z22_DTLIB2,'')) WHEN ''  THEN Null ELSE convert(datetime, Z22010.Z22_DTLIB2, 112)END AS 'DT APROV 2',
	Case RTrim(Coalesce(Z22010.Z22_DTLIB3,'')) WHEN ''  THEN Null ELSE convert(datetime, Z22010.Z22_DTLIB3, 112)END AS 'DT APROV 3'
	
	-- Z22010.Z22_APROV4,
	-- Z22010.Z22_DTLIB4,
	-- Z22010.Z22_LIBOK4,
	-- Z22010.Z22_APROV5,
	-- Z22010.Z22_LIBOK5,
	-- Z22010.Z22_DTLIB5,
	-- Z22010.Z22_APROV6,
	-- Z22010.Z22_DTLIB6,
	-- Z22010.Z22_LIBOK6,
	-- Z22010.Z22_APROV7,
	-- Z22010.Z22_LIBOK7,
	-- Z22010.Z22_DTLIB7,
	-- Z22010.Z22_CODUSR
FROM PROTHEUS.dbo.Z22010 Z22010
	LEFT JOIN PROTHEUS.dbo.SD3010 SD3010 ON 
		(SD3010.D_E_L_E_T_<>'*') AND 
		(SD3010.D3_ESTORNO='') AND 
		(Z22010.Z22_FILIAL+Z22010.Z22_ALMDES=SD3010.D3_FILIAL+SD3010.D3_LOCAL) AND 
		(SD3010.D3_DOC=Z22010.Z22_SD3DOC) AND 
		(SD3010.D3_COD=Z22010.Z22_PRDDES) AND 
		(Z22010.Z22_APROV='L')

WHERE
	Z22010.D_E_L_E_T_<>'*'

ORDER BY 
	-- Z22010.Z22_FILIAL,
	-- Z22010.Z22_ALMORI,
	-- Z22010.Z22_DOC,
	-- PRODUTO.COD_GRUPO,
	-- Z22010.Z22_PRDORI
	Z22010.Z22_EMISSA DESC
